<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sidebar Memo</title>
  <style>
    :root { color-scheme: light dark; }
    body { margin: 0; font-family: system-ui, -apple-system, "Segoe UI", sans-serif; }
    header { position: sticky; top: 0; padding: 8px 10px; border-bottom: 1px solid rgba(127,127,127,.35); backdrop-filter: blur(6px); }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    button, input[type="file"] {
      font: inherit; padding: 6px 10px; border-radius: 10px;
      border: 1px solid rgba(127,127,127,.45); background: transparent; cursor: pointer;
    }
    button:active { transform: translateY(1px); }
    .meta { margin-left: auto; opacity: .75; font-size: 12px; }
    textarea {
      width: 100%; height: calc(100vh - 58px);
      box-sizing: border-box; border: 0; outline: none; resize: none;
      padding: 10px; font: 14px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      background: transparent;
    }
    .toast {
      position: fixed; right: 10px; bottom: 10px;
      padding: 8px 10px; border-radius: 10px;
      border: 1px solid rgba(127,127,127,.45); background: rgba(0,0,0,.12);
      display: none; font-size: 12px;
    }
    #btnMore{
  margin-left:auto;
  width:34px;
  text-align:center;
}
.more{
  display:none;
  padding-top:8px;
}
.more.open{ display:block; }

.fileLabel{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:10px;
  border:1px solid rgba(127,127,127,.45);
  cursor:pointer;
  user-select:none;
}
.fileLabel input[type="file"]{
  display:none; /* ← でかい部品を隠す */
}

  </style>
</head>
<body>
  <header>
  <div class="row">
    <button id="btnCopy" title="全内容をクリップボードへ">コピー</button>
    <button id="btnDownload" title="txtとして保存">保存</button>

    <button id="btnMore" aria-expanded="false" title="その他">⋯</button>

    <span class="meta" id="meta">-</span>
  </div>

  <div class="more" id="more">
    <div class="row" style="gap:6px;">
      <label class="fileLabel" title="txtを読み込み">
        読込
        <input id="file" type="file" accept=".txt,text/plain" />
      </label>
      <button id="btnClear" title="内容を消去（確認あり）">クリア</button>
    </div>
  </div>
</header>


  <textarea id="memo" spellcheck="false" placeholder="ここにメモ。自動保存されます。"></textarea>
  <div class="toast" id="toast">保存しました</div>

  <script>
    // ---- 超軽量方針 ----
    // ・localStorageに保存（通信なし）
    // ・入力時は debounce で保存頻度を抑える
    // ・表示は文字数/行数だけ

    const KEY = "sidebar_memo_v1";
    const ta = document.getElementById("memo");
    const meta = document.getElementById("meta");
    const toast = document.getElementById("toast");

    function showToast(msg) {
      toast.textContent = msg;
      toast.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.style.display = "none", 900);
    }

    function updateMeta() {
      const text = ta.value;
      const lines = text.length ? (text.match(/\n/g)?.length ?? 0) + 1 : 0;
      meta.textContent = `${text.length} chars / ${lines} lines`;
    }

    // load
    ta.value = localStorage.getItem(KEY) ?? "";
    updateMeta();

    // save (debounced)
    let t = null;
    ta.addEventListener("input", () => {
      updateMeta();
      clearTimeout(t);
      t = setTimeout(() => {
        localStorage.setItem(KEY, ta.value);
        showToast("保存しました");
      }, 350);
    });

    // copy
    document.getElementById("btnCopy").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(ta.value);
        showToast("コピーしました");
      } catch {
        // クリップボードが拒否されたときの保険
        ta.select();
        document.execCommand("copy");
        showToast("コピーしました");
      }
    });

    // download
    document.getElementById("btnDownload").addEventListener("click", () => {
      const blob = new Blob([ta.value], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const stamp = new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");
      a.href = url;
      a.download = `memo-${stamp}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showToast("保存ファイルを作りました");
    });

    // load file
    document.getElementById("file").addEventListener("change", async (e) => {
      const f = e.target.files?.[0];
      if (!f) return;
      const text = await f.text();
      ta.value = text;
      localStorage.setItem(KEY, ta.value);
      updateMeta();
      showToast("読み込みました");
      e.target.value = "";
    });

    // clear
    document.getElementById("btnClear").addEventListener("click", () => {
      if (!confirm("内容を消します。OK？")) return;
      ta.value = "";
      localStorage.setItem(KEY, "");
      updateMeta();
      showToast("クリアしました");
    });
    // 追加：その他メニューの開閉
const btnMore = document.getElementById("btnMore");
const more = document.getElementById("more");
btnMore.addEventListener("click", () => {
  const open = more.classList.toggle("open");
  btnMore.setAttribute("aria-expanded", open ? "true" : "false");
});

  </script>
</body>
</html>

